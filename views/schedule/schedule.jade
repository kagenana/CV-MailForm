extends ../layout

block content
  .container
      h2 Active Schedule List
      if session.isState == "exist"
        button.btn.btn-large.btn-primary.disabled(disabled, style="width: 500px;") Exist
      if session.isState == "left"
        button.btn.btn-large.btn-success.disabled(disabled, style="width: 500px;") Left
      if session.isState == "goout"
        button.btn.btn-large.btn-warning.disabled(disabled, style="width: 500px;") Go Out
      table.table.table-bordered.table-striped.table-hover(style="width: 500px;, margin-bottom: 0px; margin-top: 3px;")
          tbody
            tr.table-bordered
              td(style="text-align: center;")
                if session.isState == "exist"
                  a.button.btn.btn-success(href="#Inputleft", data-toggle="modal")
                    i.icon-pause.icon-white
                    |   Left
                else
                  button.btn.btn-success(disabled)
                    i.icon-pause
                    |   Left
              td(style="text-align: center;")
                if session.isState == "exist"
                  a.button.btn.btn-warning(href="#Inputgoout", data-toggle="modal")
                    i.icon-stop.icon-white
                    |   Go Out
                else
                  button.btn.btn-warning(disabled)
                    i.icon-stop
                    |   Go Out
              td(style="text-align: center;")
                form.form.horisontal(method="post", action="/schedule/input", style="margin-bottom: 0px;")
                  .control-group(style="margin-bottom: 0px;")
                    .control
                      button.btn.btn-info(disabled, title="すみません、まだ未実装です。")
                        i.icon-edit.icon-white
                        |   Custom Input
              td(style="text-align: center;")
                if session.isState == "exist"
                  button.btn.btn-primary(disabled)
                    i.icon-play
                    |   Exist
                else
                  form.form.horisontal(method="post", action="/schedule/chg_status", style="margin-bottom: 0px;")
                    .control-group(style="margin-bottom: 0px;")
                      .control
                        input(type="hidden", name="status", placeholder="status", style="margin-bottom: 0px;", value="exist")
                        input(type="hidden", name="description", placeholder="description", style="margin-bottom: 0px;", value="")
                        button.btn.btn-primary
                          i.icon-play.icon-white
                          |   Exist
      - if(messages)
          each message in messages
            .alert.alert-success
              button.close(data-dismiss="alert")&times;
              | #{messages}
      form.form.horisontal(method="post", action="/schedule/input")
        table.table.table-bordered.table-striped.table-hover
          caption CV-MailForm Active Schedule List
          .control-group
            thead
              tr.table-bordered
                th #
                th.span1 Status
                th.span5 Description
                th.span2 Leaving Time
                th.span2 Return Time
                th.span1 Mail
                th.span1 Edit
                th.span1 Cancel
            tbody
              for schedule, i in schedules
                - var index = i +1
                tr
                  td= index
                  td
                    if schedules[i].subject == "left"
                      span.label.label-success 離席
                    if schedules[i].subject == "goout"
                      span.label.label-warning 外出
                    if schedules[i].subject == "exist"
                      span.label.label-info 戻り
                  td= schedules[i].Description
                  td
                    if(schedules[i].timeRequest)
                      - var date = encodeDate(schedules[i].timeRequest)
                      p #{date}
                  td
                    if(schedules[i].timeReturn)
                      - var date = encodeDate(schedules[i].timeReturn)
                      p #{date}
                  td
                    if schedules[i].isState == "que"
                      span.label.label-warning Que
                    if schedules[i].isState == "sent"
                      span.label.label-info Sent
                    if schedules[i].isState == "calcel"
                      span.label.label-danger Cancel
                    if schedules[i].isState == "archive"
                      span.label.label-inverse archive
                  td
                    if schedules[i].isState == "que"
                      form.form.horisontal(method="post", action="/schedule/input", style="margin-bottom: 0px;")
                        .control-group(style="margin-bottom: 0px;")
                          .control
                            input(type="hidden", name="_id", placeholder="_id", style="margin-bottom: 0px;", value="#{schedules[i]._id}")
                            button.btn.btn-success.btn-mini Edit
                    else
                      button.btn.btn-success.btn-mini(disabled) Edit
                  td
                    if schedules[i].isState == "que"
                      form.form.horisontal(method="post", action="/schedule/input", style="margin-bottom: 0px;")
                        .control-group(style="margin-bottom: 0px;")
                          .control
                            input(type="hidden", name="_id", placeholder="_id", style="margin-bottom: 0px;", value="#{schedules[i]._id}")
                            button.btn.btn-danger.btn-mini Cancel
                    else
                      button.btn.btn-danger.btn-mini(disabled) Cancel
                - function encodeDate(date) {
                  - var y = date.getFullYear();
                  - var m = date.getMonth()+1;
                  - var d = date.getDate();
                  - m = ('0' + m).slice(-2);
                  - d = ('0' + d).slice(-2);
                  - var hh = date.getHours()
                  - var mm = date.getMinutes();
                  - hh = ('0' + hh).slice(-2);
                  - mm = ('0' + mm).slice(-2);
                  - var w = date.getDay();
                  - var week = "";
                  - if (w == 0) week = "(日)";
                  - if (w == 1) week = "(月)";
                  - if (w == 2) week = "(火)";
                  - if (w == 3) week = "(水)";
                  - if (w == 4) week = "(木)";
                  - if (w == 5) week = "(金)";
                  - if (w == 6) week = "(土)";
                  - return y + "/" + m + "/" + d + week + " " + hh + ":" + mm;
                - };
    .modal.hide.fade(id="Inputleft", tabindex="-1", role="dialog", aria-labelledby="leftInputLabel", aria-hidden="true")
      .modal-header
        button.close(type="button", data-dismiss="modal", aria-hidden="true")&times;
        button.btn.btn-large.btn-success.disabled(id="leftInputLabel", disabled, style="width: 500px;") Left Input Detail
      form.form.horisontal(method="post", action="/schedule/chg_status", style="margin-bottom: 0px;")
        .modal-body
          .control-group(style="margin-bottom: 0px;")
            .control
        table.table.table-bordered.table-striped.table-hover
          tbody
            tr.control-group
              td.controls
                select(style="margin-bottom: 0px;", name="description")
                    option(value="", selected) 指定なし
                    option(value="社内会議") 社内会議
                    option(value="来客対応") 来客対応
                    option(value="食事") 食事
                    input(type="hidden", name="status", placeholder="status", style="margin-bottom: 0px;", value="left")
              td 予定の詳細を選択します。
            tr.control-group
              td.controls
                .input-append.date.form_datetime(title="カレンダーをクリックして編集します。")
                  input(type="text", name="timeReturn", placeholder="戻り未定", style="margin-bottom: 0px;", value="", readonly)
                  span.add-on
                    i.icon-remove
                  span.add-on
                    i.icon-time
                label.checkbox(style="margin-left: 198px;") 終日予定
                  input(type="checkbox", name="fulltime", value="true")
              td
                p 帰社予定時間を記載します。
                pre
                 | 未定:時刻をクリアしてください。
                 | 終日:時刻は無視されます。
        .modal-footer
          .control-group(style="margin-bottom: 0px;")
            .control
              button.btn(type="button", data-dismiss="modal", aria-hidden="true") Close
              button.btn.btn-primary(type="submit") Submit
      
    .modal.hide.fade(id="Inputgoout", tabindex="-1", role="dialog", aria-labelledby="gooutInputLabel", aria-hidden="true")
      .modal-header
        button.close(type="button", data-dismiss="modal", aria-hidden="true")&times;
        button.btn.btn-large.btn-warning.disabled(id="gooutInputLabel", disabled, style="width: 500px;") Go out Input Detail
      form.form.horisontal(method="post", action="/schedule/chg_status", style="margin-bottom: 0px;")
        .modal-body
          .control-group(style="margin-bottom: 0px;")
            .control
        table.table.table-bordered.table-striped.table-hover
          tbody
            tr.control-group
              td.controls
                select(style="margin-bottom: 0px;", name="description")
                    option(value="", selected) 指定なし
                    option(value="客先打ち合わせ") 客先打ち合わせ
                    option(value="現場作業") 現場作業
                    option(value="出張") 出張
                    option(value="休暇") 休暇
                    input(type="hidden", name="status", placeholder="status", style="margin-bottom: 0px;", value="goout")
              td 予定の詳細を選択します。
            tr.control-group
              td.controls
                .input-append.date.form_datetime(title="カレンダーをクリックして編集します。")
                  input(type="text", name="timeReturn", placeholder="戻り未定", style="margin-bottom: 0px;", value="", readonly)
                  span.add-on
                    i.icon-remove
                  span.add-on
                    i.icon-time
                label.checkbox(style="margin-left: 198px;") 終日予定
                  input(type="checkbox", name="fulltime", value="true")
              td
                p 帰社予定時間を記載します。
                pre
                 | 未定:時刻をクリアしてください。
                 | 終日:時刻は無視されます。
        .modal-footer
          .control-group(style="margin-bottom: 0px;")
            .control
              button.btn(type="button", data-dismiss="modal", aria-hidden="true") Close
              button.btn.btn-primary(type="submit") Submit

    script(type="text/javascript")
      $(function() {
        $('#scheduleImput').validate({
          rules : {
            'subject' : { required: true }
          },
          errorElement: "label",
          errorClass: "alert alert-error"
        });
      });
      $(function() {
        $(".form_datetime").datetimepicker({
          format: 'yyyy/mm/dd hh:ii',
          startView: 1,
          autoclose: true,
          pickerPosition: "bottom-left"
        });
      });
      
      
  #container